name: Deploy Container App

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  deployApp:
    runs-on: ubuntu-latest
    steps:
    - name: Log in to Azure
      uses: azure/login@v1.4.6
      with:
        creds: ${{ secrets.CAPP_AZ_CREDS }}

    - name: Build and deploy Container App
      uses: azure/container-apps-deploy-action@v0
      with:
        resourceGroup: containerapp
        imageToDeploy: crazk8sfk9l7tj5rxbdipvfs.azurecr.io/azuredocs/azure-vote-
        acrName: crazk8sfk9l7tj5rxbdipvfs
        acrUsername: ${{ secrets.REGISTRY_USERNAME }}
        acrPassword: ${{ secrets.REGISTRY_PASSWORD }}
        
        resource symbolicname 'Microsoft.ContainerRegistry/registries@2022-12-01' = {
  name: 'string'
  location: 'string'
  tags: {
    tagName1: 'tagValue1'
    tagName2: 'tagValue2'
  }
  sku: {
    name: 'string'
  }
  identity: {
    principalId: 'string'
    tenantId: 'string'
    type: 'string'
    userAssignedIdentities: {}
  }
  properties: {
    adminUserEnabled: bool
    dataEndpointEnabled: bool
    encryption: {
      keyVaultProperties: {
        identity: 'string'
        keyIdentifier: 'string'
      }
      status: 'string'
    }
    networkRuleBypassOptions: 'string'
    networkRuleSet: {
      defaultAction: 'string'
      ipRules: [
        {
          action: 'Allow'
          value: 'string'
        }
      ]
    }
    policies: {
      exportPolicy: {
        status: 'string'
      }
      quarantinePolicy: {
        status: 'string'
      }
      retentionPolicy: {
        days: int
        status: 'string'
      }
      trustPolicy: {
        status: 'string'
        type: 'Notary'
      }
    }
    publicNetworkAccess: 'string'
    zoneRedundancy: 'string'
  }
}
